# AugmentationFlow - Periodic Checkpoint Examples
# Various configurations for periodic image saving

agent: augmentation_flow

dataset: cifar10
batch_size: 128
epochs: 100

model: unet_rectified_flow
optimizer: adam
lr: 0.0001

transform:
  weak: "normalize"
  strong: "rand_augment | normalize"

predict: flow
use_ema: true

# === Example 1: Save every 5 epochs ===
checkpoint:
  model:
    save_dir: checkpoints/example1
  image:
    save_dir: results/example1
  periodic:
    save_dir: results/example1/periodic
    save_every_n_epochs: 5     # Every 5 epochs
    keep_last: 10              # Keep last 10 (50 epochs worth)

# === Example 2: Save every 1000 steps ===
# checkpoint:
#   model:
#     save_dir: checkpoints/example2
#   image:
#     save_dir: results/example2
#   periodic:
#     save_dir: results/example2/periodic
#     save_every_n_steps: 1000   # Every 1000 steps
#     keep_last: 20              # Keep last 20 checkpoints

# === Example 3: Save both epochs AND steps ===
# checkpoint:
#   model:
#     save_dir: checkpoints/example3
#   image:
#     save_dir: results/example3
#   periodic:
#     save_dir: results/example3/periodic
#     save_every_n_epochs: 10    # Every 10 epochs
#     save_every_n_steps: 5000   # AND every 5000 steps
#     keep_last: 15

# === Example 4: High-frequency monitoring (every epoch) ===
# checkpoint:
#   model:
#     save_dir: checkpoints/example4
#   image:
#     save_dir: results/example4
#   periodic:
#     save_dir: results/example4/periodic
#     save_every_n_epochs: 1     # Every epoch
#     save_on_start: true        # Also save on epoch 0
#     keep_last: 20              # Keep last 20 epochs

# === Example 5: Long training with sparse saves ===
# checkpoint:
#   model:
#     save_dir: checkpoints/example5
#   image:
#     save_dir: results/example5
#   periodic:
#     save_dir: results/example5/periodic
#     save_every_n_epochs: 20    # Every 20 epochs
#     keep_last: null            # Keep all (no deletion)

# === Example 6: Custom filename format ===
# checkpoint:
#   model:
#     save_dir: checkpoints/example6
#   image:
#     save_dir: results/example6
#   periodic:
#     save_dir: results/example6/periodic
#     save_every_n_epochs: 5
#     name_format: "augflow_epoch_{counter}_comparison.{ext}"
#     keep_last: 8

save_checkpoint_every: 1000
save_results_every: 500
num_samples: 16

device: 0

# === Usage Notes ===
#
# Periodic checkpoint automatically saves at epoch end (via evaluate())
#
# Files saved to: results/example1/periodic/
# - epoch_comparison_5.png
# - epoch_comparison_10.png
# - epoch_comparison_15.png
# - ... (keeps last 10)
#
# Auto-cleanup: Old files are deleted when keep_last limit is reached
#
# To disable periodic saving:
# - Omit the "periodic" section entirely
# - Or set both save_every_n_epochs and save_every_n_steps to null
