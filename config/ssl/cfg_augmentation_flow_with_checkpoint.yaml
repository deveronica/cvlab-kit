# AugmentationFlow with Checkpoint Components
# Using checkpoint components for clean artifact management

agent: augmentation_flow

dataset: cifar10
batch_size: 128
epochs: 100

model: unet_rectified_flow
optimizer: adam
lr: 0.0001

transform:
  weak: "resize(size=32) | random_flip | normalize"
  strong: "resize(size=32) | random_flip | rand_augment(n=2, m=10) | normalize"
  normalizer: data_normalizer
  unnormalizer: data_normalizer(inverse=true)
  noise_schedule: noise_schedule(schedule_type="cosine")

solver: euler

predict: flow
max_grad_norm: 1.0

# Conditioning
use_conditioning: false

# EMA
use_ema: true
ema_kwargs:
  beta: 0.995
  update_every: 10

# === Checkpoint Components ===
checkpoint:
  # Model checkpoint (PyTorch models, optimizer, training state)
  model:
    save_dir: checkpoints/augmentation_flow
    auto_save_latest: true    # Auto-save as "latest.pt"
    save_optimizer: true      # Include optimizer in checkpoint
    verbose: true

  # Image checkpoint (visualizations, samples)
  image:
    save_dir: results/augmentation_flow
    format: png               # Options: png, jpg
    quality: 95               # JPEG quality (1-100)
    normalize: true           # Auto-normalize to [0,1]
    nrow: 4                   # Images per row in grid
    padding: 2                # Pixels between images
    verbose: true

  # Periodic checkpoint (save images every N epochs)
  periodic:
    save_dir: results/augmentation_flow/periodic
    save_every_n_epochs: 5    # Save images every 5 epochs
    save_every_n_steps: null  # Disabled (use null or omit)
    save_on_start: false      # Don't save on epoch 0
    keep_last: 10             # Keep only last 10 periodic saves
    name_format: "{prefix}_{counter}.{ext}"
    format: png
    normalize: true
    verbose: true

# Checkpoint frequency
save_checkpoint_every: 1000
save_results_every: 500

# Sampling
sample_steps: 50
num_samples: 16
sample_condition: 1.0

# Logging
logger: tensorboard
log_dir: logs/augmentation_flow

device: 0

# === Usage Notes ===
# Model checkpoints saved to: checkpoints/augmentation_flow/
# - checkpoint_step_1000.pt, checkpoint_step_2000.pt, ...
# - latest.pt (auto-updated)
#
# Image artifacts saved to: results/augmentation_flow/
# - step_500.png, step_1000.png, ...
#
# In Agent code:
# - self.model_checkpoint.save(state, "my_checkpoint.pt")
# - self.image_checkpoint.save_comparison([img1, img2], "comparison.png")
